<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binance USDT Perpetual Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:white; padding:20px; }
    h1 { text-align:center; margin-bottom:10px; }
    .card { background:#1e293b; padding:15px; border-radius:10px; margin:10px 0; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:15px; }
    .green { color:lime; font-weight:bold; }
    .red { color:#f87171; font-weight:bold; }
    footer { text-align:center; font-size:0.85em; margin-top:20px; opacity:0.7; }
  </style>
</head>
<body>
  <h1>📊 Binance USDT Perpetual Tracker</h1>
  <p><strong>Last Updated (Davao City):</strong> <span id="lastUpdated">--:--:--</span></p>

  <div class="card">
    <h2>🧮 General Market Bias</h2>
    <p>✅ Green: <span id="green" class="green">0</span> | ❌ Red: <span id="red" class="red">0</span></p>
  </div>

  <div class="card">
    <h2>🔄 24h Price Change</h2>
    <div class="grid">
      <div>📈 Price Increase (≥ 5%): <span id="increase">0</span></div>
      <div>➖ Mild Movement (±0–5%): <span id="mild">0</span></div>
      <div>📉 Price Drop (≤ -5%): <span id="drop">0</span></div>
    </div>
  </div>

  <div class="card">
    <h2>Funding Signals</h2>
    <div class="grid">
      <div>📈 Bullish Potential (Shorts Paying) ➕: <span id="bullPlus">0</span></div>
      <div>📈 Bullish Potential ➖: <span id="bullMinus">0</span></div>
      <div>📉 Bearish Risk (Longs Paying) ➕: <span id="bearPlus">0</span></div>
      <div>📉 Bearish Risk ➖: <span id="bearMinus">0</span></div>
    </div>
  </div>

  <footer>
    Auto-updates every 60s from Binance Futures API
  </footer>

  <script>
    async function fetchData() {
      try {
        const [tickerRes, fundingRes] = await Promise.all([
          fetch("https://fapi.binance.com/fapi/v1/ticker/24hr"),
          fetch("https://fapi.binance.com/fapi/v1/premiumIndex")
        ]);
        const tickers = await tickerRes.json();
        const funding = await fundingRes.json();

        // Filter USDT perpetual pairs only
        const usdtTickers = tickers.filter(t => t.symbol.endsWith("USDT"));
        const usdtFunding = funding.filter(f => f.symbol.endsWith("USDT"));

        // Counters
        let green = 0, red = 0;
        let increase = 0, mild = 0, drop = 0;
        let bullPlus = 0, bullMinus = 0;
        let bearPlus = 0, bearMinus = 0;

        // Market summary
        usdtTickers.forEach(t => {
          const change = parseFloat(t.priceChangePercent);
          if (change > 0) green++; else if (change < 0) red++;
          if (change >= 5) increase++;
          else if (change <= -5) drop++;
          else mild++;
        });

        // Funding analysis
        usdtFunding.forEach(f => {
          const rate = parseFloat(f.lastFundingRate);
          const symbol = f.symbol;
          const change = parseFloat(
            usdtTickers.find(t => t.symbol === symbol)?.priceChangePercent || 0
          );

          if (rate < 0) {
            // Shorts pay longs → Bullish potential
            if (change > 0) bullPlus++; else bullMinus++;
          } else if (rate > 0) {
            // Longs pay shorts → Bearish risk
            if (change < 0) bearPlus++; else bearMinus++;
          }
        });

        // Update DOM
        document.getElementById("lastUpdated").innerText = new Date().toLocaleTimeString("en-PH", { hour12: true });
        document.getElementById("green").innerText = green;
        document.getElementById("red").innerText = red;
        document.getElementById("increase").innerText = increase;
        document.getElementById("mild").innerText = mild;
        document.getElementById("drop").innerText = drop;
        document.getElementById("bullPlus").innerText = bullPlus;
        document.getElementById("bullMinus").innerText = bullMinus;
        document.getElementById("bearPlus").innerText = bearPlus;
        document.getElementById("bearMinus").innerText = bearMinus;

      } catch (err) {
        console.error("Error fetching data:", err);
      }
    }

    // Initial fetch + refresh every 60s
    fetchData();
    setInterval(fetchData, 60000);
  </script>
</body>
</html>
